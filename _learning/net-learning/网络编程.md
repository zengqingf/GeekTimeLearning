# 网络编程

* 工具

  * 测试网络请求的网站

    [https://httpbin.org/](https://httpbin.org/)

    ``` tex
    详见上述官网
    
    [http://httpbin.org/ip]返回Origin IP。
    [http://httpbin.org/user-agent]返回用户代理。
    [http://httpbin.org/headers]返回标头字典。
    [http://httpbin.org/get]返回GET数据。
    [http://httpbin.org/post]返回POST数据。
    [http://httpbin.org/put]返回PUT数据。
    [http://httpbin.org/delete]返回DELETE数据
    [http://httpbin.org/gzip]返回gzip编码的数据。
    [http://httpbin.org/status/:code]返回给定的HTTP状态代码。
    [http://httpbin.org/response-headers?key=val]返回给定的响应标头。
    [http://httpbin.org/redirect/:n] 302重定向n次。
    [http://httpbin.org/relative-redirect/:n] 302相对重定向n次。
    [http://httpbin.org/cookies]返回cookie数据。
    [http://httpbin.org/cookies/set/:name/:value]设置一个简单的cookie。
    [http://httpbin.org/basic-auth/:user/:passwd]挑战HTTPBasic Auth。
    [http://httpbin.org/hidden-basic-auth/:user/:passwd] 404'd BasicAuth。
    [http://httpbin.org/digest-auth/:qop/:user/:passwd]挑战HTTP Digest Auth。
    [http://httpbin.org/stream/:n] Streams n-100行。
    [http://httpbin.org/delay/:n]延迟响应n-10秒。
    ```

    

    [http://ptsv2.com/](http://ptsv2.com/)

    ``` tex
    This is a service for developers testing clients that POST and GET things over HTTP.
    ```

  * 接口测试工具

    Postman

    [YApi](https://hellosean1025.github.io/yapi/)

    [JMeter压测](https://jmeter.apache.org/)

    [SoapUI](https://www.soapui.org/)

    [ApiPost](https://www.apipost.cn/)



* 教程&文档

  * link

    [MDN 学习区](https://developer.mozilla.org/zh-CN/docs/Learn)

  * 文档

    * http request header

      | Header              | 解释                                                         | 示例                                                   |
      | :------------------ | :----------------------------------------------------------- | :----------------------------------------------------- |
      | Accept              | 指定客户端能够接收的内容类型                                 | Accept:text/plain,text/html                            |
      | Accept-Charset      | 浏览器可以接受的字符编码集。                                 | Accept-Charset:iso-8859-5                              |
      | Accept-Encoding     | 指定浏览器可以支持的web服务器返回内容压缩编码类型。          | Accept-Encoding:compress,gzip                          |
      | Accept-Language     | 浏览器可接受的语言                                           | Accept-Language:en,zh                                  |
      | Accept-Ranges       | 可以请求网页实体的一个或者多个子范围字段                     | Accept-Ranges:bytes                                    |
      | Authorization       | HTTP授权的授权证书                                           | Authorization:Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==       |
      | Cache-Control       | 指定请求和响应遵循的缓存机制                                 | Cache-Control:no-cache                                 |
      | Connection          | 表示是否需要持久连接。（HTTP 1.1默认进行持久连接）           | Connection:close                                       |
      | Cookie              | HTTP请求发送时，会把保存在该请求域名下的所有cookie值一起发送给web服务器。 | Cookie:$Version=1;Skin=new;                            |
      | Content-Length      | 请求的内容长度                                               | Content-Length:348                                     |
      | Content-Type        | 请求的与实体对应的MIME信息                                   | Content-Type:application/x-www-form-urlencoded         |
      | Date                | 请求发送的日期和时间                                         | Date:Tue,15 Nov 2010 08:12:31 GMT                      |
      | Expect              | 请求的特定的服务器行为                                       | Expect:100-continue                                    |
      | From                | 发出请求的用户的Email                                        | From:user@email.com                                    |
      | Host                | 指定请求的服务器的域名和端口号                               | Host:www.zcmhi.com                                     |
      | If-Match            | 只有请求内容与实体相匹配才有效                               | If-Match:“737060cd8c284d8af7ad3082f209582d”            |
      | If-Modified-Since   | 如果请求的部分在指定时间之后被修改则请求成功，未被修改则返回304代码 | If-Modified-Since:Sat,29 Oct 2010 19:43:31 GMT         |
      | If-None-Match       | 如果内容未改变返回304代码，参数为服务器先前发送的Etag，与服务器回应的Etag比较判断是否改变 | If-None-Match:“737060cd8c284d8af7ad3082f209582d”       |
      | If-Range            | 如果实体未改变，服务器发送客户端丢失的部分，否则发送整个实体。参数也为Etag | If-Range:“737060cd8c284d8af7ad3082f209582d”            |
      | If-Unmodified-Since | 只在实体在指定时间之后未被修改才请求成功                     | If-Unmodified-Since:Sat,29 Oct 2010 19:43:31 GMT       |
      | Max-Forwards        | 限制信息通过代理和网关传送的时间                             | Max-Forwards:10                                        |
      | Pragma              | 用来包含实现特定的指令                                       | Pragma:no-cache                                        |
      | Proxy-Authorization | 连接到代理的授权证书                                         | Proxy-Authorization:Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ== |
      | Range               | 只请求实体的一部分，指定范围                                 | Range:bytes=500-999                                    |
      | Referer             | 先前网页的地址，当前请求网页紧随其后,即来路                  | Referer:http:                                          |
      | TE                  | 客户端愿意接受的传输编码，并通知服务器接受接受尾加头信息     | TE:trailers,deflate;q=0.5                              |
      | Upgrade             | 向服务器指定某种传输协议以便服务器进行转换（如果支持）       | Upgrade:HTTP/2.0,SHTTP/1.3,IRC/6.9,RTA/x11             |
      | User-Agent          | User-Agent的内容包含发出请求的用户信息                       | User-Agent:Mozilla/5.0(Linux;X11)                      |
      | Via                 | 通知中间网关或代理服务器地址，通信协议                       | Via:1.0 fred,1.1 nowhere.com(Apache/1.1)               |
      | Warning             | 关于消息实体的警告信息                                       | Warn:199 Miscellaneous warning                         |







---





### 框架学习

* ACE with C++

  

  



---



### 断线重连

* 断线触发情况

  * 弱网（网络波动，网络信号减弱，出现延迟、丢包率上升，引起卡住，拖拽甚至掉线，之后可能恢复正常或者直接掉线）

    注意点：

    * 服务器可能多次收到客户端同一请求，在涉及例如领取奖励和金币扣除等影响玩家收益的相关协议上，客户端和服务器需要做好协议ID重复请求的处理

    * 弱网环境下，网络会显式抛出异常（大部分是NetworkException，少部分是Timeout，和连接关闭等其他异常），此时说明网络已经无法顺利和服务器进行连接；在这些消息类型中，对于客户端断网或网络波动导致的原因，客户端就会触发断线重连流程

    * 当检测到连接断开时，客户端并不能马上提示要重连，而是等玩家主动点击游戏内功能（客户端和服务器直接发生协议请求时候弹出），或者静默等待10s后弹出，避免在弱网环境下频繁打扰

      **弱网时，判定网络断线后，进入10s保护期，进行静默重连，如果出发与服务器的交互，则立即静默重连**

  * 切换后台

    * 有网状态下

      * X分钟内进入，不进行断线重连
      * X分钟后进入，进行断线重连

    * 无网状态下

      进行重连

    * 超过20分钟切换

      直接走重新登录

  * 客户端关闭

    * 将当前游戏环境，各个玩家的状态直接以大包形式同步给客户端，客户端进行解析后同步到当前状态（或者客户端在关闭之前的游戏时进行缓存游戏状态（帧），重进游戏时从缓存的最后帧开始请求服务器同步到当前帧）

* 断线重连方式

  * 重连

    游戏检测到客户端和服务器之间发送协议时链接断开无法发包，然后将原来的Socket关闭，重新启用一个新的Socket尝试进行连接，并且让客户端恢复到断线前，同步游戏环境的过程

  * 顶号的异常情况

    顶号方会正常进入游戏，被顶号方会弹出提示“已被顶号”，重新走登录流程

    在处理顶和被顶之间需要做一个缓冲机制，防止出现互顶情况

* 案例

  恋与制作人

  ``` tex
  1.登录界面无法连接：弹出提示：网络错误，请检查网络连接。
  
  2.s游戏内界面：锁定操作，界面出现转菊花，持续10秒未响应，则弹出失败提示：重连失败，请检查网络。并自动跳转回登录界面。
  
  3、剧情、战斗中：不锁定操作，静默重连1min。若失败，界面显示转菊花，持续10秒未响应，则弹出失败提示：重连失败，请检查网络。并自动跳转回登录界面。
  ```

  

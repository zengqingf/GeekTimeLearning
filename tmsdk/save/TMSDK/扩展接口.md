# 扩展接口

``` java
    /**
     * unity项目启动时的上下文
     */
    private Activity _unityActivity;

    /**
     * 获取Unity正在启动的Activity.
     * @return
     */
    public Activity getUnityActivity(){
        if(_unityActivity==null) {
            try {
                Class<?> classtype = Class.forName("com.unity3d.player.UnityPlayer");
                Activity activity = (Activity) classtype.getDeclaredField("currentActivity").get(classtype);
                _unityActivity = activity;
            } catch (ClassNotFoundException e) {

            } catch (IllegalAccessException e) {

            } catch (NoSuchFieldException e) {

            }
        }
        return _unityActivity;
    }
```

``` text
public class SDKMessage
{
	public SDKMessage(int type)
	{
		Type = type;
	}

	/** 
	 调用方法类型.
	*/
	public int Type = -1;



//补充：
// SDK版本号
// 渠道
// 签名信息
// ...


	/////////////////////////Unity 传递给 SDK 的数据.

	/** 
	 价格.
	*/
	public float Money = -1f;
	/** 
	 订单号
	*/
	public String OrderId = "";
	/** 
	 创建订单时间.
	*/
	public long RechargeTime = -1;
	/** 
	 商品ID.
	*/
	public int ProductID = -1;
	/** 
	 商品名字.
	*/
	public String ProductName = "";
	/** 
	 商品描述.
	*/
	public String ProductDescription = "";


	/** 
	 上传角色信息类型 创建 登入 升级 退出
	*/
	public int UploadRoleInfoType = -1;

	/** 
	 角色ID.
	*/
	public long RoleId = -1;
	/** 
	 角色名字.
	*/
	public String RoleName = "";
	/** 
	 角色等级.
	*/
	public int RoleLevel = -1;
	/** 
	 角色职业ID.
	*/
	public int RoleProfessionalID = -1;
	/** 
	 角色职业名字.
	*/
	public String RoleProfessionalName = "";
	/** 
	 角色战斗力.
	*/
	public int RolePower = -1;
	/** 
	 角色创建时间.
	*/
	public String CreateRoleTime = "";
	/** 
	 角色升级时间.
	*/
	public String RoleUpgradeTime = "";
	/** 
	 剩余钻石.
	*/
	public int Diamond = -1;
	/** 
	 区服ID.
	*/
	public int AreaId = -1;
	/** 
	 区服名字.
	*/
	public String ArenName = "";
	/** 
	 VIP等级.
	*/
	public int VIPLevel = -1;
	/** 
	 公会Id.
	*/
	public long GangID = -1;
	/** 
	 公会名字.
	*/
	public String GangName = "";
	/** 
	 公司名字.
	*/
	public String CompanyName = "";


	/////////////////////////SDK 传递给 Unity 的数据.
	/** 
	 用户ID.
	*/
	public String UserID = "";
	/** 
	 Token.
	*/
	public String Token = "";


	/////////////////////////补充的10个变量.
	public String ComplementaryVariable0 = "";
	public String ComplementaryVariable1 = "";
	public String ComplementaryVariable2 = "";
	public String ComplementaryVariable3 = "";
	public String ComplementaryVariable4 = "";
	public String ComplementaryVariable5 = "";
	public String ComplementaryVariable6 = "";
	public String ComplementaryVariable7 = "";
	public String ComplementaryVariable8 = "";
	public String ComplementaryVariable9 = "";
}
```

``` objective-c
    // Helper method to create C string copy
    char* MakeStringCopy (const char* string)
    {
        if (string == NULL)
        {
            return NULL;
        }
        char* res = (char*)malloc(strlen(string) + 1);
        memset(res,0,strlen(string) + 1);
        strcpy(res, string);
        return res;
        
    }

	SDKMessage * Parse(const char * data)
    {
        SDKMessage * message = new SDKMessage(1);
        
        NSString * jsonString =[NSString stringWithUTF8String: data];
        
        NSLog(@"jsonString--->%@",jsonString);
        
        //将字符串写到缓冲区。
        NSData* jsonData = [jsonString dataUsingEncoding:NSUTF8StringEncoding];
        
        //解析json数据，使用系统方法 JSONObjectWithData:  options: error:
        NSDictionary* dic = [NSJSONSerialization JSONObjectWithData:jsonData options:NSJSONReadingMutableLeaves error:nil];
        
        //接下来一步一步解析。知道得到你想要的东西。
        message->Type =[[dic objectForKey:@"Type"]intValue];
        message->Money =[[dic objectForKey:@"Money"]floatValue];
        message->OrderId =[[dic objectForKey:@"OrderId"] UTF8String];
        message->RechargeTime =[[dic objectForKey:@"RechargeTime"]longLongValue];
       
        return message;
    }

	
	void SDKToUnity(SDKMessage * message)
    {
        // 如果数组或者字典中存储了  NSString, NSNumber, NSArray, NSDictionary, or NSNull 之外的其他对象,就不能直接保存成文件了.也不能序列化成 JSON 数据.
        NSDictionary *dict = @{
                               @"Type" :[NSString stringWithFormat:@"%d", message->Type],
                               @"Money" : [NSString stringWithFormat:@"%f", message->Money],
                               @"OrderId" :[NSString stringWithUTF8String: message->OrderId],
                               @"RechargeTime" : [NSString stringWithFormat:@"%lld", message->RechargeTime],
                               @"UserID" :[NSString stringWithFormat:@"%s", message->UserID]
                               };
        
        // 1.判断当前对象是否能够转换成JSON数据.
        // YES if obj can be converted to JSON data, otherwise NO
        BOOL isYes = [NSJSONSerialization isValidJSONObject:dict];
        
        if (isYes) {
            NSLog(@"可以转换");
            
            /* JSON data for obj, or nil if an internal error occurs. The resulting data is a encoded in UTF-8.
             */
            NSData *jsonData = [NSJSONSerialization dataWithJSONObject:dict options:0 error:NULL];
            
            /*
             Writes the bytes in the receiver to the file specified by a given path.
             YES if the operation succeeds, otherwise NO
             */
            // 将JSON数据写成文件
            // 文件添加后缀名: 告诉别人当前文件的类型.
            // 注意: AFN是通过文件类型来确定数据类型的!如果不添加类型,有可能识别不了! 自己最好添加文件类型.
            //[jsonData writeToFile:@"/Users/SunnyBoy/Sites/JSON_XML/dict.json" atomically:YES];
            
            NSLog(@"%@", [[NSString alloc] initWithData:jsonData encoding:NSUTF8StringEncoding]);
            
            const char * data =[[[NSString alloc] initWithData:jsonData encoding:NSUTF8StringEncoding] UTF8String] ;
            
            UnitySendMessage("SDKManager", "SDKToUnity",  data);
           
        } else {
            NSLog(@"JSON数据生成失败，请检查数据格式");
        }
    }
```



``` java
    void handleIntent(Intent intent) {
        if(intent == null || intent.getExtras() == null) return;

        if(intent.getExtras().containsKey("doQuit"))
            if(mUnityPlayer != null) {
                finish();
            }
    }

    @Override
    protected void showMainActivity(String setToColor) {
        Intent intent = new Intent(this, MainActivity.class);
        intent.setFlags(Intent.FLAG_ACTIVITY_REORDER_TO_FRONT | Intent.FLAG_ACTIVITY_SINGLE_TOP);
        intent.putExtra("setColor", setToColor);
        startActivity(intent);
    }

    public void btnLoadUnity(View v) {
        isUnityLoaded = true;
        Intent intent = new Intent(this, MainUnityActivity.class);
        intent.setFlags(Intent.FLAG_ACTIVITY_REORDER_TO_FRONT);
        startActivityForResult(intent, 1);
    }


    public void unloadUnity(Boolean doShowToast) {
        if(isUnityLoaded) {
            Intent intent = new Intent(this, MainUnityActivity.class);
            intent.setFlags(Intent.FLAG_ACTIVITY_REORDER_TO_FRONT);
            intent.putExtra("doQuit", true);
            startActivity(intent);
            isUnityLoaded = false;
        }
        else if(doShowToast) showToast("Show Unity First");
    }
```



[Unity通过NDK、JNI实现C#、java、C/C++之间的相互调用](https://linxinfa.blog.csdn.net/article/details/108642977)

``` java
//Java call C#
//Unity： UnityPlayer.UnitySendMessage(...)
    
//Java call C++
//
```

``` c#
//C# call Java


//C# call C++

```

``` c++
//C++ call Java


//C++ call C#

```



